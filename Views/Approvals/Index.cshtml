@model List<ConsumerApp.ProductApproval>

@{
    ViewData["Title"] = "Mahsulotlarni tasdiqlash";
    var currentFilter = ViewData["CurrentFilter"]?.ToString() ?? "pending";
}

<div class="page-header">
    <h1>✅ Mahsulotlarni Tasdiqlash Paneli</h1>
    <p>Kafka orqali kelgan mahsulotlarni ko'rib chiqing</p>
</div>

<!-- Filter Tabs -->
<div class="filter-tabs">
    <a href="@Url.Action("Index", new { filter = "pending" })"
       class="filter-tab @(currentFilter == "pending" ? "active" : "")">
        ⏳ Kutilmoqda (@ViewBag.PendingCount)
    </a>
    <a href="@Url.Action("Index", new { filter = "approved" })"
       class="filter-tab @(currentFilter == "approved" ? "active" : "")">
        ✅ Tasdiqlangan (@ViewBag.ApprovedCount)
    </a>
    <a href="@Url.Action("Index", new { filter = "rejected" })"
       class="filter-tab @(currentFilter == "rejected" ? "active" : "")">
        ❌ Rad etilgan (@ViewBag.RejectedCount)
    </a>
    <a href="@Url.Action("Index", new { filter = "all" })"
       class="filter-tab @(currentFilter == "all" ? "active" : "")">
        📋 Barchasi (@ViewBag.TotalCount)
    </a>
</div>

@if (!Model.Any())
{
    <div class="empty-state">
        <div class="empty-icon">📭</div>
        <h3>Mahsulotlar yo'q</h3>
        <p>Hozircha bu bo'limda mahsulotlar mavjud emas.</p>
    </div>
}
else
{
    <form method="post" action="@Url.Action("BulkApprove")" class="approval-form">
        @Html.AntiForgeryToken()

        @if (currentFilter == "pending")
        {
            <div class="bulk-actions">
                <label class="checkbox-label">
                    <input type="checkbox" class="select-all-checkbox">
                    <strong>Barchasini tanlash</strong>
                </label>
                <button type="submit" class="btn btn-success">
                    ✅ Tanlanganlarni tasdiqlash
                </button>
            </div>
        }

        <div class="products-grid">
            @foreach (var item in Model)
            {
                <div class="product-card @(item.Status.ToLower())">
                    @if (currentFilter == "pending")
                    {
                        <label class="card-checkbox">
                            <input type="checkbox" name="selectedIds" value="@item.Id" class="product-checkbox">
                            <span class="checkbox-mark"></span>
                        </label>
                    }

                    <div class="product-status-badge">
                        @if (item.Status == "Approved")
                        {
                            <span class="status-approved">✅ Tasdiqlangan</span>
                        }
                        else if (item.Status == "Rejected")
                        {
                            <span class="status-rejected">❌ Rad etilgan</span>
                        }
                        else
                        {
                            <span class="status-pending">⏳ Kutilmoqda</span>
                        }
                    </div>

                    <div class="product-info">
                        <h3 class="product-name">@item.ProductName</h3>
                        <div class="product-meta">
                            <span class="category-badge">@item.Category</span>
                            <span class="price-badge">@item.Price.ToString("N0") so'm</span>
                        </div>
                    </div>

                    <div class="product-details">
                        <div class="detail-row">
                            <span class="detail-label">Producer ID:</span>
                            <span class="detail-value">@item.ProductId</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Miqdor:</span>
                            <span class="detail-value">@item.Quantity dona</span>
                        </div>
                        @if (!string.IsNullOrEmpty(item.Manufacturer))
                        {
                            <div class="detail-row">
                                <span class="detail-label">Ishlab chiqaruvchi:</span>
                                <span class="detail-value">@item.Manufacturer</span>
                            </div>
                        }
                        <div class="detail-row">
                            <span class="detail-label">Qabul qilingan:</span>
                            <span class="detail-value">@item.ReceivedDate.ToString("dd.MM.yyyy HH:mm")</span>
                        </div>
                        @if (item.ReviewedDate.HasValue)
                        {
                            <div class="detail-row">
                                <span class="detail-label">Ko'rib chiqilgan:</span>
                                <span class="detail-value">@item.ReviewedDate.Value.ToString("dd.MM.yyyy HH:mm")</span>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(item.RejectionReason))
                        {
                            <div class="detail-row rejection">
                                <span class="detail-label">Rad etish sababi:</span>
                                <span class="detail-value">@item.RejectionReason</span>
                            </div>
                        }
                    </div>

                    @if (!string.IsNullOrEmpty(item.Description))
                    {
                        <div class="product-description">
                            <strong>Ta'rif:</strong>
                            <p>@item.Description</p>
                        </div>
                    }

                    @if (item.Status == "Pending")
                    {
                        <div class="product-actions">
                            <a href="@Url.Action("Review", new { id = item.Id })" class="btn btn-primary">
                                👁️ Ko'rib chiqish
                            </a>
                        </div>
                    }
                </div>
            }
        </div>
    </form>
}

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fa;
        line-height: 1.6;
    }

    .page-header {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 2rem;
        margin-bottom: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

        .page-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

    /* Filter Tabs */
    .filter-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .filter-tab {
        padding: 0.75rem 1.5rem;
        background: white;
        color: #333;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

        .filter-tab:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .filter-tab.active {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

    /* Bulk Actions */
    .bulk-actions {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .checkbox-label {
        color: white;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        font-size: 1.1rem;
    }

    .select-all-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    /* Products Grid */
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .product-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        position: relative;
        transition: all 0.3s ease;
    }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .product-card.approved {
            border-left: 4px solid #28a745;
        }

        .product-card.rejected {
            border-left: 4px solid #dc3545;
        }

        .product-card.pending {
            border-left: 4px solid #ffc107;
        }

    .card-checkbox {
        position: absolute;
        top: 1rem;
        left: 1rem;
        cursor: pointer;
    }

        .card-checkbox input {
            display: none;
        }

    .checkbox-mark {
        display: inline-block;
        width: 24px;
        height: 24px;
        background: white;
        border: 2px solid #ddd;
        border-radius: 4px;
        position: relative;
        transition: all 0.3s ease;
    }

    .card-checkbox:hover .checkbox-mark {
        border-color: #667eea;
    }

    .card-checkbox input:checked ~ .checkbox-mark {
        background: #667eea;
        border-color: #667eea;
    }

        .card-checkbox input:checked ~ .checkbox-mark::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
        }

    .product-card:has(.product-checkbox:checked) {
        background: linear-gradient(135deg, #e7f3ff 0%, #d1ecf1 100%);
    }

    .product-status-badge {
        text-align: right;
        margin-bottom: 1rem;
    }

    .status-approved {
        background: #d4edda;
        color: #155724;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .status-rejected {
        background: #f8d7da;
        color: #721c24;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .status-pending {
        background: #fff3cd;
        color: #856404;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .product-info {
        margin-bottom: 1rem;
    }

    .product-name {
        font-size: 1.3rem;
        color: #333;
        margin-bottom: 0.5rem;
    }

    .product-meta {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    .category-badge {
        background: #e7f3ff;
        color: #0066cc;
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .price-badge {
        background: #fff3cd;
        color: #856404;
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .product-details {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 6px;
        margin-bottom: 1rem;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid #e9ecef;
    }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-row.rejection {
            flex-direction: column;
            gap: 0.25rem;
            background: #fff3cd;
            padding: 0.75rem;
            border-radius: 4px;
            border: none;
        }

    .detail-label {
        color: #6c757d;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .detail-value {
        color: #212529;
        font-weight: 500;
    }

    .product-description {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 6px;
        margin-bottom: 1rem;
        font-size: 0.95rem;
    }

        .product-description strong {
            display: block;
            margin-bottom: 0.5rem;
            color: #667eea;
        }

        .product-description p {
            margin: 0;
            color: #666;
        }

    .product-actions {
        display: flex;
        gap: 0.75rem;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s ease;
        text-align: center;
    }

    .btn-primary {
        background: #667eea;
        color: white;
        flex: 1;
    }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

    .btn-success {
        background: #28a745;
        color: white;
    }

        .btn-success:hover {
            background: #218838;
        }

    /* Empty State */
    .empty-state {
        background: white;
        padding: 4rem 2rem;
        text-align: center;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .empty-state h3 {
        color: #666;
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: #999;
    }

    @@media (max-width: 768px) {
        .products-grid

    {
        grid-template-columns: 1fr;
    }

    .filter-tabs {
        flex-direction: column;
    }

    .filter-tab {
        width: 100%;
    }

    .bulk-actions {
        flex-direction: column;
        align-items: stretch;
    }

    .btn-success {
        width: 100%;
    }

    }
</style>